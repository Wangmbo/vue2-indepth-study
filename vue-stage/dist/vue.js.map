{"version":3,"file":"vue.js","sources":["../src/utils.js","../src/observer/array.js","../src/observer/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["export function isFuntion(data) {\n  return typeof data === 'function'\n}\n\nexport function isObject(val) {\n  return typeof val === 'object' && val != null\n}","export let arrayMethods = Object.create(Array.prototype)\n\nlet oldArrayPrototype = Array.prototype\n\nlet methods = ['push', 'shift', 'pop', 'unshift', 'reverse']\n\nmethods.forEach(method => {\n  arrayMethods[method] = function(...args) {\n    console.log('数组发生变化...')\n    // TODO 如果是push了一个对象之类的，也需要劫持...\n    return oldArrayPrototype[method].call(this, ...args)\n  }\n})","import { isObject } from \"../utils\";\nimport { arrayMethods } from './array'\nclass Observe {\n  constructor(data) { // 对对象中的所有属性进行劫持\n    if(Array.isArray(data)) {\n      // 数组劫持的逻辑\n      // 核心思想是对数组的方法进行劫持\n      // 对数组原来的方法进行改写，切片编程 高阶函数\n      data.__proto__ = arrayMethods\n\n      this.observeArray(data)\n    } else {\n      this.walk(data)\n    }\n  }\n  // 循环遍历劫持...\n  walk(data) { // 对象\n    Object.keys(data).forEach((key) => {\n      defineReactive(data, key, data[key])\n    })\n  }\n\n  observeArray(data) {\n    // console.log(data, 'observeArray')\n    data.forEach(item => {\n      observe(item)\n    })\n  }\n}\n\nfunction defineReactive(data, key, value) {\n  observe(value)\n  // TODO Object.defineProperties\n  console.log(data, 'data')\n  Object.defineProperty(data, key, {\n    get() {\n      console.log(key, 'get')\n      return value\n    },\n    set(val) {\n      console.log(key, val, 'set')\n      observe(value)\n      value = val\n    }\n  })\n}\n\n// import { isObject } from '../utils'\nexport function observe(data) {\n  // 如果是对象才观测\n  if(!isObject(data)) return\n  // if(!isObject(data)) return\n  return new Observe(data)\n}\n// vue2 没有对数组进行索引的劫持\n// 而且一般用户很少通过索引去操作数组.\n// 内部就想到不对索引进行拦截，因为消耗严重.\n// 数组没有监控索引的变化，但是索引对应的内容是对象类型，需要被监控\n\n// 重写了push shift pop unshift reverse sort splice\n// 这几个方法","import { observe } from './observer/index'\nimport { isFuntion } from './utils'\nexport function initState(vm) {\n  const opts = vm.$options\n  if(opts.data) {\n    initData(vm)\n  }\n  if(opts.props) {\n\n  }\n}\n\n\nfunction initData(vm) { // vm\n  let data  = vm.$options.data\n  // 会将data中的所有数据进行数据劫持\n  // defineProperty\n  // 判断类型\n  console.log(data)\n  data = vm._data = isFuntion(data) ? data.call(vm) : data\n\n  for(let key in data) {\n    proxy(vm, '_data', key)\n  }\n  observe(data)\n  // console.log(data)\n}\n\n\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key]\n    },\n    set(newValue) {\n      vm[source][key] = newValue\n    }\n  })\n}\n","import { initState } from './state'\nexport function initMixin(Vue) { // 表示在vue的基础上做一次混合操作\n  // 默认下划线是私有的\n  Vue.prototype._init = function(options) {\n    console.log(options)\n    const vm = this\n    // vue内部会对属性检测如果是$开头的就不会进行代理\n    vm.$options = options // 后面会对options进行扩展, 这里目前是用户传入的options\n\n    // 对数据进行初始化 watch computed props data\n    initState(vm) // vm 指向当前实例\n  }\n}","import { initMixin } from './init'\n\nfunction Vue(options) {\n  // options 为用户传入的选项\n  this._init(options)\n}\n\ninitMixin(Vue)\n\nexport default Vue"],"names":["isFuntion","data","isObject","val","arrayMethods","Object","create","Array","prototype","oldArrayPrototype","methods","forEach","method","console","log","args","call","Observe","isArray","__proto__","observeArray","walk","keys","key","defineReactive","item","observe","value","defineProperty","get","set","initState","vm","opts","$options","initData","props","_data","proxy","source","newValue","initMixin","Vue","_init","options"],"mappings":"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"}